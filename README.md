# 积分计算和排名脚本

## 功能说明

这个脚本用于根据生产数据计算积分并生成排名，支持以下功能：

1. **积分计算**：
   - A1-A5机台：早班不低于156.84箱、中班不低于143.16箱，完成产量要求积1分；两班当日总产量不低于300箱各积4分
   - A9机台：早班不低于41箱、中班不低于39箱，完成产量要求积1分；两班当日总产量不低于80箱各积4分

2. **台时不足处理**：
   - 如果报工数据为空，则表示当天台时不足，不计入竞赛天数
   - 台时不足的记录积分显示为"/"
   - 排名计算时自动排除台时不足的天数

3. **排名计算**：
   - 区分甲乙班进行排名
   - 按积分从高到低排序
   - 积分相同时按产量排序
   - 只计算有效记录（排除台时不足的天数）

4. **总分计算**：
   - 计算每个机台在有效竞赛天数中的总积分
   - 区分甲乙班分别计算总分
   - 提供平均积分和有效天数统计
   - 按总分进行排名

5. **数据处理**：
   - 自动读取Excel文件中的所有sheet（每个sheet代表一天）
   - 生成每日积分统计和总排名
   - 生成总分排名表
   - 统计台时不足情况
   - 输出结果到新的Excel文件

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

1. 确保`data.xlsx`文件在脚本同一目录下
2. 运行脚本：

```bash
python calculate_scores.py
```

## 输入数据格式

Excel文件应包含以下列：
- 机号
- 甲班计划
- 甲班报工
- 乙班计划
- 乙班报工

每个sheet代表一天的数据（如9.1、9.2等）

## 输出结果

脚本会生成`积分排名结果.xlsx`文件，包含：
- 总分排名：各机台总分排名（按甲乙班分别计算）
- 总排名：所有日期的综合排名
- 每日积分：每个日期的详细积分计算
- 排名按甲乙班分别计算

## 积分规则示例

### 正常情况
以A1机台为例：
- 早班产量160箱，中班产量145箱，总产量305箱
- 早班：160 ≥ 156.84 ✓ (1分) + 305 ≥ 300 ✓ (4分) = 5分
- 中班：145 ≥ 143.16 ✓ (1分) + 305 ≥ 300 ✓ (4分) = 5分

### 台时不足情况
- 如果报工数据为空（NaN或0），则显示为"/"
- 台时不足的天数不计入竞赛排名
- 例如：A04机台某日报工数据为空，则当日积分显示为"/"，不参与排名计算

### 总分计算示例
以A01机台为例：
- 甲班4天有效记录，总积分20分，平均积分5.00分
- 乙班4天有效记录，总积分17分，平均积分4.25分
- 总分排名：甲班第1名，乙班第1名
