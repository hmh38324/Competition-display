<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç«èµ›æ’åç³»ç»Ÿ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .tab {
            padding: 12px 24px;
            margin: 0 5px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab:hover {
            background: rgba(255,255,255,0.15);
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ranking-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .ranking-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease;
        }

        .ranking-table tr:hover {
            background-color: #f8f9fa;
        }

        .ranking-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .rank-1 { color: #ffd700; font-weight: bold; }
        .rank-2 { color: #c0c0c0; font-weight: bold; }
        .rank-3 { color: #cd7f32; font-weight: bold; }
        
        /* ä¸ºå‰å››åæ·»åŠ æµ…è“è‰²åº•è‰² */
        .ranking-table tbody tr:nth-child(1) {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
        }
        .ranking-table tbody tr:nth-child(2) {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
        }
        .ranking-table tbody tr:nth-child(3) {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
        }
        .ranking-table tbody tr:nth-child(4) {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
        }

        .score-high { color: #27ae60; font-weight: bold; }
        .score-medium { color: #f39c12; font-weight: bold; }
        .score-low { color: #e74c3c; font-weight: bold; }

        .insufficient { color: #95a5a6; font-style: italic; }


        .date-selector {
            margin-bottom: 20px;
        }

        .date-selector select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .date-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                margin: 5px;
                padding: 10px 16px;
            }
            
            .ranking-table {
                font-size: 0.9rem;
            }
            
            .ranking-table th,
            .ranking-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-trophy"></i> ç”Ÿäº§ç«èµ›æ’åç³»ç»Ÿ</h1>
            <p>å®æ—¶å±•ç¤ºå„æœºå°ç«èµ›æ’åå’Œç§¯åˆ†ç»Ÿè®¡</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('total')">
                <i class="fas fa-medal"></i> æ€»åˆ†æ’å
            </button>
            <button class="tab" onclick="showTab('details')">
                <i class="fas fa-chart-bar"></i> è¯¦ç»†æ•°æ®
            </button>
        </div>

        <div class="content">
            <!-- æ€»åˆ†æ’å -->
            <div id="total-tab" class="tab-content">
                <h2 class="section-title">
                    <i class="fas fa-crown"></i> æ€»åˆ†æ’å
                </h2>
                <div class="ranking-table-container">
                    <table class="ranking-table" id="total-ranking-table">
                        <thead>
                            <tr>
                                <th>æ’å</th>
                                <th>æœºå·</th>
                                <th>ç­æ¬¡</th>
                                <th>æ€»ç§¯åˆ†</th>
                                <th>æœ‰æ•ˆå¤©æ•°</th>
                                <th>æ—¥å‡ç§¯åˆ†</th>
                            </tr>
                        </thead>
                        <tbody id="total-ranking-body">
                            <tr>
                                <td colspan="6" class="loading">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <!-- è¯¦ç»†æ•°æ® -->
            <div id="details-tab" class="tab-content" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-database"></i> è¯¦ç»†æ•°æ®
                </h2>
                <div class="date-selector">
                    <label for="details-date-select">é€‰æ‹©æ—¥æœŸï¼š</label>
                    <select id="details-date-select" onchange="updateDetailsData()">
                        <option value="">è¯·é€‰æ‹©æ—¥æœŸ</option>
                    </select>
                </div>
                <div class="ranking-table-container">
                    <table class="ranking-table" id="details-table">
                        <thead>
                            <tr>
                                <th>æœºå·</th>
                                <th>ç”²ç­(ä¸­ç­)äº§é‡</th>
                                <th>ç”²ç­(ä¸­ç­)ç§¯åˆ†</th>
                                <th>ä¹™ç­(æ—©ç­)äº§é‡</th>
                                <th>ä¹™ç­(æ—©ç­)ç§¯åˆ†</th>
                                <th>æ€»äº§é‡</th>
                                <th>å°æ—¶çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="details-body">
                            <tr>
                                <td colspan="7" class="loading">è¯·é€‰æ‹©æ—¥æœŸ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>æ•°æ®æ›´æ–°æ—¶é—´ï¼š<span id="last-updated">-</span></p>
            <p>&copy; 2024 ç”Ÿäº§ç«èµ›æ’åç³»ç»Ÿ</p>
        </div>
    </div>

    <script>
        let competitionData = null;

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                competitionData = await response.json();
                console.log('æ•°æ®åŠ è½½æˆåŠŸ:', competitionData);
                initializePage();
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showError(`åŠ è½½æ•°æ®å¤±è´¥: ${error.message}ã€‚è¯·ç¡®ä¿data.jsonæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚`);
                
                // å°è¯•åŠ è½½ç¤ºä¾‹æ•°æ®
                try {
                    const sampleResponse = await fetch('sample_data.json');
                    if (sampleResponse.ok) {
                        competitionData = await sampleResponse.json();
                        console.log('ä½¿ç”¨ç¤ºä¾‹æ•°æ®');
                        initializePage();
                        showError('æ­£åœ¨ä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼Œè¯·æ£€æŸ¥data.jsonæ–‡ä»¶');
                    }
                } catch (sampleError) {
                    console.error('ç¤ºä¾‹æ•°æ®ä¹ŸåŠ è½½å¤±è´¥:', sampleError);
                }
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            if (!competitionData) return;

            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            document.getElementById('last-updated').textContent = competitionData.last_updated;

            // åˆå§‹åŒ–æ€»åˆ†æ’å
            updateTotalRanking();

            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
            initializeDateSelectors();

            // æ˜¾ç¤ºé»˜è®¤æ ‡ç­¾é¡µ
            showTab('total');
        }

        // æ›´æ–°æ€»åˆ†æ’å
        function updateTotalRanking() {
            if (!competitionData) return;

            const totalRankings = competitionData.total_rankings;
            const tbody = document.getElementById('total-ranking-body');
            
            // æ¸…ç©ºè¡¨æ ¼
            tbody.innerHTML = '';

            // æŒ‰æ’åæ’åºï¼Œä¸æŒ‰ç­æ¬¡åˆ†ç»„
            const sortedRankings = totalRankings.sort((a, b) => a.æ’å - b.æ’å);

            // æ·»åŠ æ‰€æœ‰æ’å
            sortedRankings.forEach(ranking => {
                const row = createTotalRankingRow(ranking);
                tbody.appendChild(row);
            });

        }

        // è·å–å¸¦å›¾æ ‡çš„æ’å
        function getRankWithIcon(rank) {
            if (rank === 1) return 'ğŸ† 1';
            if (rank === 2) return 'ğŸ¥ˆ 2';
            if (rank === 3) return 'ğŸ¥‰ 3';
            if (rank === 4) return 'ğŸ¥‰ 4';
            return rank;
        }

        // åˆ›å»ºæ€»åˆ†æ’åè¡Œ
        function createTotalRankingRow(ranking) {
            const row = document.createElement('tr');
            
            const rankClass = ranking.æ’å <= 3 ? `rank-${ranking.æ’å}` : '';
            const scoreClass = getScoreClass(ranking.æ€»ç§¯åˆ†);
            const rankWithIcon = getRankWithIcon(ranking.æ’å);
            
            row.innerHTML = `
                <td class="${rankClass}">${rankWithIcon}</td>
                <td><strong>${ranking.æœºå·}</strong></td>
                <td>${ranking.ç­æ¬¡}</td>
                <td class="${scoreClass}">${ranking.æ€»ç§¯åˆ†}</td>
                <td>${ranking.æœ‰æ•ˆå¤©æ•°}</td>
                <td class="${scoreClass}">${ranking.æ—¥å‡ç§¯åˆ†}</td>
            `;
            
            return row;
        }


        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        function initializeDateSelectors() {
            if (!competitionData) return;

            const dates = Object.keys(competitionData.daily_scores).sort();
            const detailsDateSelect = document.getElementById('details-date-select');

            dates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = date;
                detailsDateSelect.appendChild(option);
            });
        }


        // æ›´æ–°è¯¦ç»†æ•°æ®
        function updateDetailsData() {
            if (!competitionData) return;

            const selectedDate = document.getElementById('details-date-select').value;
            const tbody = document.getElementById('details-body');
            
            if (!selectedDate) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading">è¯·é€‰æ‹©æ—¥æœŸ</td></tr>';
                return;
            }

            const dailyScores = competitionData.daily_scores[selectedDate];
            
            tbody.innerHTML = '';
            
            // åŠ¨æ€è·å–åˆ—å
            const sample = dailyScores[0];
            const jiaProductionCol = Object.keys(sample).find(key => key.includes('ç”²ç­') && key.includes('äº§é‡'));
            const jiaScoreCol = Object.keys(sample).find(key => key.includes('ç”²ç­') && key.includes('ç§¯åˆ†'));
            const yiProductionCol = Object.keys(sample).find(key => key.includes('ä¹™ç­') && key.includes('äº§é‡'));
            const yiScoreCol = Object.keys(sample).find(key => key.includes('ä¹™ç­') && key.includes('ç§¯åˆ†'));
            
            // æ›´æ–°è¡¨å¤´
            const thead = document.querySelector('#details-table thead tr');
            thead.innerHTML = `
                <th>æœºå·</th>
                <th>${jiaProductionCol}</th>
                <th>${jiaScoreCol}</th>
                <th>${yiProductionCol}</th>
                <th>${yiScoreCol}</th>
                <th>æ€»äº§é‡</th>
                <th>å°æ—¶çŠ¶æ€</th>
            `;
            
            dailyScores.forEach(score => {
                const row = document.createElement('tr');
                
                const jiaScoreClass = score[jiaScoreCol] === '/' ? 'insufficient' : getScoreClass(parseInt(score[jiaScoreCol]) || 0);
                const yiScoreClass = score[yiScoreCol] === '/' ? 'insufficient' : getScoreClass(parseInt(score[yiScoreCol]) || 0);
                const statusClass = score.å°æ—¶ä¸è¶³ ? 'insufficient' : '';
                
                row.innerHTML = `
                    <td><strong>${score.æœºå·}</strong></td>
                    <td class="${score[jiaProductionCol] === '/' ? 'insufficient' : ''}">${score[jiaProductionCol]}</td>
                    <td class="${jiaScoreClass}">${score[jiaScoreCol]}</td>
                    <td class="${score[yiProductionCol] === '/' ? 'insufficient' : ''}">${score[yiProductionCol]}</td>
                    <td class="${yiScoreClass}">${score[yiScoreCol]}</td>
                    <td class="${score.æ€»äº§é‡ === '/' ? 'insufficient' : ''}">${score.æ€»äº§é‡}</td>
                    <td class="${statusClass}">${score.å°æ—¶ä¸è¶³ ? 'å°æ—¶ä¸è¶³' : 'æ­£å¸¸'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // è·å–ç§¯åˆ†æ ·å¼ç±»
        function getScoreClass(score) {
            if (score >= 5) return 'score-high';
            if (score >= 3) return 'score-medium';
            if (score > 0) return 'score-low';
            return '';
        }

        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.content').insertBefore(errorDiv, document.querySelector('.content').firstChild);
        }

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æ•°æ®
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
